---
title: '나인 크로니클 출시까지의 과정 : 탈중앙 게임이란?'
date: 2020-09-24
authors: [muhun.kim]
---

안녕하세요! 2개월 동안 플라네타리움의 엔지니어링 인턴으로 일한 김무훈입니다. 저는 나인 크로니클의 정식 출시 직전의 베타 과정을 지켜 보았는데요. 탈중앙 온라인 게임을 운영하면서 특이하다고 느낀 문제를 간단하게 소개드립니다.

나인 크로니클은 오랜 기간동안 CBT에 가려져 있어서 "탈중앙" 키워드 외에는 공개된 정보가 적었습니다.

저는 엔지니어링 팀에 합류하면서 아래의 상황이 궁금했습니다.

1. 정말 완전한 탈중앙화 온라인 게임인지
2. 블록체인 위의 게임은 중앙화 게임과 사용자 경험이 어떻게 다를까?

## 무엇이 탈중앙화일까

탈중앙 온라인 게임인지 의문을 갖기 전에 **탈중앙이 뭔지** 짚어 가야 합니다.

P2P, 아니면 분산화 기술이라고 한번쯤은 들어 보셨을 수 있고, 탈중앙은 이 기술을 묶어서 전통적인 서버의 역할을 게임 사용자에게 분담해두는 형태를 의미합니다.

대부분의 온라인 게임은 멀티 플레이를 위해서나, 사용자의 데이터를 저장하기 위한 중앙 서버가 있습니다. 여러 이유로 (운영사가 폐업하는 등) 서버가 운영되지 않으면 온라인 게임을 플레이할 수 없습니다. 그러나 모두가 서버를 운영하는 발상을 하면 서비스가 종료될 걱정은 하지 않아도 됩니다. 정확히는 게임 사용자에게 서버의 역할을 분담해두는 뜻입니다.

### 블록체인 위의 온라인 게임

플라네타리움은 여러 분산화 기술 중에 블록체인에 관심을 가져 탈중앙 레퍼런스 게임 "나인 크로니클"을 만들고 있습니다. 블록체인은 여러 노드가 경쟁하여 블록을 채굴하고 다른 노드에게 빨리 전파하기 노력합니다. 여러 분기로 나누어지는 체인 네트워크를 하나로 수렴하기 위한 방법인데요. 이건 나중에 더 설명을 하겠습니다. 나인 크로니클은 게임 내 재화 뿐만 아니라 게임 플레이 데이터도 게임 클라이언트가 다른 노드에 전파하기 위해 노력하는 체계를 갖고 있습니다.

이 과정에서 블록체인 네트워크의 초기에 일어나는 긴 개편 현상을 게임 커뮤니티에서 자주 목격했습니다. 자세히는 사용자가 과거에 플레이했던 시간, 레벨, 아이템 정보가 전파에 실패해서 사라지는 사례로, 블록체인 네트워크의 초기에 주로 발생하는 현상입니다.

### 개편(reorganization) 현상

블록의 체인을 재구성하는 걸 의미합니다. 블록체인 커뮤니티에서는 리오그(reorg)라 줄여서 부릅니다. 이 글에서도 편의상 리오그라 칭하겠습니다.

{{<
figure
  src="images/single-chian.png"
  caption="블록을 연결하는 체인은 단 하나다"
>}}

개편 현상에 대해 설명하기 전에 블록체인의 분기는 단 하나라는 사실을 알아두셔야 됩니다.

블록체인의 블록은 누구나 생성할 수 있습니다. 그러나 여러 노드가 같은 시점에 블록을 이어 만든다면 체인이 여러 개로 분리될 것 같습니다. 어떻게 블록체인은 하나의 체인을 유지할 수 있는 걸까요?

{{<
figure
  src="images/orphaned-block.png"
  caption="비슷한 시점에 더 많은 블록을 이은 체인을 선택한다."
>}}

답은 간단합니다. 비슷한 시점에 더 많은 블록을 이으고 다른 노드에게 빨리 전파하는 체인을 채택합니다. 위 사진에서는 블록 두개의 차이를 두고 파란 블록의 체인이 채택이 되었습니다.

{{<
figure
  src="images/orphaned-blocks.png"
  caption="5개의 길이를 가진 빨간 블록의 체인이 파란 블록으로 개편된다"
>}}

보통의 경우 블록 한두 개를 두고 짧게 개편이 일어나지만 나누어진 블록의 깊이가 두개보다 더 많다면 긴 리오그가 일어납니다.

예를 들어,

1. A, B 분기로 체인이 나뉘어져 다른 노드로 전파된다.
2. 비슷한 비율로 점차 전파되는 노드가 늘어가며 체인의 길이도 늘어간다.
3. 모든 노드가 A 분기와 B 분기 중 하나를 채택했고, A 분기의 체인이 더 길고 채택된 비율이 높다.
4. B 분기의 체인을 채택한 모든 노드의 체인이 A로 재조정 됩니다.

나인 크로니클 같은 탈중앙 게임을 모델로 소개를 드리면, A 플레이어와 B 플레이어의 게임 기록이 나뉘어졌다가 나중에 B 플레이어어의 기록이 A 플레이어의 기록으로 덮어 띄어지는 현상입니다.

<!-- TODO: 커뮤니티 리오그 제보 사진 추가하기 -->

그래서 재조정 현상 때문에 시간, 레벨, 아이템을 잃었다는 이야기가 나인 크로니클 커뮤니티에서 자주 언급되었습니다. 탈중앙 네트워크에서 발생한 일이기 때문에 운영진에게 되돌려달라고 할 수도 없는 노릇입니다. 엔지니어링 팀 내부에서는 플레이했던 기록이 꿈처럼 되어 버린다고 해서 "신기루" 현상이라고 부릅니다.

### 블록체인 네트워크 초기화

나인 크로니클은 베타 기간 동안 체인 네트워크를 여러 번 초기화했습니다. 체인 네트워크가 초기화되면 게임 플레이어가 일구었던 게임 데이터가 모두 사라지게 됩니다.

나인 크로니클의 블록체인 네트워크를 지탱하는 Libplanet 엔진에서는 게임의 상태를 블록에 저장합니다. 사용자의 행동의 경우 Action 이라는 이름의 자료 구조에 맞추어 저장하게 됩니다.

```json
{
  "stageId": "123",
  "id": "ntPSdIREOUOARaRYJHlGEg==",
  "equipments": ["KTm6cLkrtEWs6k4A821K3Q=="],
  "avatarAddress": "sGo0bo0VwrYA7ubq6yV8ctiU2vc=",
  "foods": [],
  "worldId": "3"
}
```

만약 게임 내에서 의상 요소가 업데이트 된다면 `costumes` 같이 새로운 속성이 추가되고, 이 정보가 담긴 블럭의 해시가 이전 블럭의 해시를 만드는 규약과 맞지 않게 됩니다. 프로토콜이 달라지면 이전의 블록체인 데이터를 이어서 사용할 수 없게 됩니다. 이 외에도 유니크한 값이 다르게 되거나, Libplanet 이나 그 SDK의 코드 중에 해시에 영향이 가는 수정이 생긴다면 달라집니다.

그런 이유로 나인크로니클은 체인 네트워크의 잦은 초기화를 가했습니다. 초기화 마다 `9c-beta-*` 넘버링을 담겨서 첫 리셋에서는 `9c-beta-1` 라는 코드 네임을 사용했고, 마지막 베타 배포에는 `9c-beta-6`를 사용했습니다. 지금까지 6번 체인 리셋을 진행을 했습니다.

### 중앙화와 타협하지 않는다

플라네타리움의 전사 3분기 목표는 "혁신을 타협하지 않은 탈중앙 레퍼런스 게임을 만들자!"입니다. 나인 크로니클은 비밀번호와 함께 개인키를 사용자가 관리하는 인증 체계를 같고 있습니다. 저는 중앙화 서버에 익숙한 게이머의 멘탈 모델로는 개인키를 별도로 보관하기 불편할 법하다고 느꼈습니다.

그래서 암호화페 거래소처럼 외부에 키를 맡기는 기능이 있으면 어떨까 엔지니어링 워크샵에 의견을 꺼냈지만, 편리성을 위해 사용자의 자산을 외부에 맞기는 것은 탈중앙 게임의 좋은 레퍼런스가 아니게 된다는 의견을 받았습니다.

그러나 나인 크로니클은 오픈소스로 운영되고, 사용자의 자율성을 존중합니다. 그래서 외부에 사용자가 키를 관리하는 서드파티 서비스가 만들어지는 것에 제한을 걸지 않을 생각입니다.
